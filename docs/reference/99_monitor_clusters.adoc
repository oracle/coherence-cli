///////////////////////////////////////////////////////////////////////////////

    Copyright (c) 2024 Oracle and/or its affiliates.
    Licensed under the Universal Permissive License v 1.0 as shown at
    https://oss.oracle.com/licenses/upl.

///////////////////////////////////////////////////////////////////////////////

= Monitor Clusters

== Monitor Clusters

=== Overview
Experimental command to monitor clusters with text UI

NOTE: The `monitor cluster` command is current experimental only and may be changed or removed in the future

* <<monitor-cluster, `cohctl monitor cluster`>> - monitors the cluster using text based UI

[#monitor-cluster]
==== Monitor Cluster

include::../../build/_output/docs-gen/monitor_cluster.adoc[tag=text]

*Examples*

**Monitor a cluster using the default layout.**

[source,bash,subs="attributes"]
----
cohctl monitor cluster local
----
Output:
[source,bash,subs="attributes"]
----
Coherence CLI: 2024-05-06 11:03:17 - Monitoring cluster local (22.06.8) ESC to quit (press key in [] to toggle expand, ? = help). (69.65276ms)

┌─Members [1]─(trimmed)───────────────────────────────────────────────────────────┐┌─Health Summary [2]──────────────────────────────────────────────────────────────┐
│Total cluster members: 3                                                         ││NAME                  SUB TYPE   MEMBERS  STARTED  LIVE  READY  SAFE             │
│Storage enabled count: 3                                                         ││$SYS:Config           Service          3        3     3      3     3             │
│Departure count:       1                                                         ││$SYS:HealthHttpProxy  Service          3        3     3      3     3             │
│                                                                                 ││$SYS:SystemProxy      Service          3        3     3      3     3             │
│Cluster Heap - Total: 768 MB Used: 140 MB Available: 628 MB (81.8%)              ││Default               Coherence        3        3     3      3     3             │
│Storage Heap - Total: 768 MB Used: 140 MB Available: 628 MB (81.8%)              ││ManagementHttpProxy   Service          1        1     1      1     1             │
│                                                                                 ││PartitionedCache      Service          3        3     3      3     3             │
│NODE ID  ADDRESS     PORT   PROCESS  MEMBER     ROLE             STORAGE  MAX HEA││PartitionedTopic      Service          3        3     3      3     3             │
│      1  /127.0.0.1  51436    25773  storage-1  CoherenceServer  true       256 M││Proxy                 Service          3        3     3      3     3             │
│      2  /127.0.0.1  51438    25772  storage-0  CoherenceServer  true       256 M│└─────────────────────────────────────────────────────────────────────────────────┘
└─────────────────────────────────────────────────────────────────────────────────┘
┌─Services [3]────────────────────────────────────────────────────────────────────┐┌─Caches [4]──────────────────────────────────────────────────────────────────────┐
│SERVICE NAME            TYPE              MEMBERS  STATUS HA  STORAGE  SENIOR  PA││Total Caches: 3, Total primary storage: 0 MB                                     │
│"$SYS:Config"           DistributedCache        3  NODE-SAFE        3       3    ││                                                                                 │
│"$SYS:HealthHttpProxy"  Proxy                   3  n/a             -1       3    ││SERVICE           CACHE  COUNT  SIZE                                             │
│"$SYS:SystemProxy"      Proxy                   3  n/a             -1       3    ││PartitionedCache  test1    100  0 MB                                             │
│ManagementHttpProxy     Proxy                   1  n/a             -1       2    ││PartitionedCache  test2    100  0 MB                                             │
│PartitionedCache        DistributedCache        3  NODE-SAFE        3       3    ││PartitionedCache  test3    123  0 MB                                             │
│PartitionedTopic        PagedTopic              3  NODE-SAFE        3       3    │└─────────────────────────────────────────────────────────────────────────────────┘
│Proxy                   Proxy                   3  n/a             -1       3    │
└─────────────────────────────────────────────────────────────────────────────────┘
┌─Proxy Servers [5]───────────────────────────────────────────────────────────────┐┌─HTTP Servers [6]────────────────────────────────────────────────────────────────┐
│NODE ID  HOST IP              SERVICE NAME        CONNECTIONS  DATA SENT  DATA RE││NODE ID  HOST IP        SERVICE NAME            SERVER TYPE                      │
│1        0.0.0.0:51436.59141  "$SYS:SystemProxy"            0       0 MB      0 M││1        0.0.0.0:51468  "$SYS:HealthHttpProxy"  com.tangosol.coherence.http.JavaH│
│2        0.0.0.0:51438.44681  "$SYS:SystemProxy"            0       0 MB      0 M││2        0.0.0.0:51471  "$SYS:HealthHttpProxy"  com.tangosol.coherence.http.JavaH│
│3        0.0.0.0:51437.48751  "$SYS:SystemProxy"            0       0 MB      0 M││3        0.0.0.0:51464  "$SYS:HealthHttpProxy"  com.tangosol.coherence.http.JavaH│
│1        0.0.0.0:51436.41602  Proxy                         0       0 MB      0 M││2        0.0.0.0:30000  ManagementHttpProxy     com.tangosol.coherence.http.JavaH│
│2        0.0.0.0:51438.51496  Proxy                         0       0 MB      0 M│└─────────────────────────────────────────────────────────────────────────────────┘
│3        0.0.0.0:51437.49259  Proxy                         0       0 MB      0 M│
└─────────────────────────────────────────────────────────────────────────────────┘
┌─Network Stats [7]──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│NODE ID  ADDRESS     PORT   PROCESS  MEMBER     ROLE             PKT SENT  PKT REC  RESENT  EFFICIENCY  SEND Q  DATA SENT  DATA REC  WEAKEST                        │
│      1  /127.0.0.1  51436    25773  storage-1  CoherenceServer       272      337       3     100.00%       0       0 MB      0 MB        3                        │
│      2  /127.0.0.1  51438    25772  storage-0  CoherenceServer       166      137       1     100.00%       0       0 MB      0 MB       -1                        │
│      3  /127.0.0.1  51437    25774  storage-2  CoherenceServer       152      125       1     100.00%       0       0 MB      0 MB       -1                        │
└────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
----

You can press `?` to display the help which is shown below:
[source,bash]
----
 Monitor Cluster CLI Help

 - 'p' to toggle panel row padding
 - '+' to increase max height of all panels
 - '-' to decrease max height of all panels
 - '0' to reset max height of all panels
 - Key in [] to expand that panel
 - ESC / CTRL-C to exit monitoring

Press any key to exit help.
----

NOTE: If the title of a panel includes "trimmed" it means there are more rows to display.
You can press the key indicated in the `[]` to expand that panel.


**Monitor the cluster and specify the panels for services and caches on one line and then members on the next**

[source,bash]
----
cohctl monitor cluster local -l services,caches:members
----
Output:
[source,bash]
----
 Coherence CLI: 2024-05-06 11:10:23 - Monitoring cluster local (22.06.8) ESC to quit (press key in [] to toggle expand, ? = help).

┌─Services [1]───────────────────────────────────────────────────┐┌─Caches [2]────────────────────────────────────────────────────┐
│SERVICE NAME            TYPE              MEMBERS  STATUS HA  ST││Total Caches: 3, Total primary storage: 0 MB                   │
│"$SYS:Config"           DistributedCache        3  NODE-SAFE    ││                                                               │
│"$SYS:HealthHttpProxy"  Proxy                   3  n/a          ││SERVICE           CACHE  COUNT  SIZE                           │
│"$SYS:SystemProxy"      Proxy                   3  n/a          ││PartitionedCache  test1    100  0 MB                           │
│ManagementHttpProxy     Proxy                   1  n/a          ││PartitionedCache  test2    100  0 MB                           │
│PartitionedCache        DistributedCache        3  NODE-SAFE    ││PartitionedCache  test3    123  0 MB                           │
│PartitionedTopic        PagedTopic              3  NODE-SAFE    │└───────────────────────────────────────────────────────────────┘
│Proxy                   Proxy                   3  n/a          │
└────────────────────────────────────────────────────────────────┘
┌─Members [3]─(trimmed)───────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│Total cluster members: 3                                                                                                         │
│Storage enabled count: 3                                                                                                         │
│Departure count:       1                                                                                                         │
│                                                                                                                                 │
│Cluster Heap - Total: 768 MB Used: 300 MB Available: 468 MB (60.9%)                                                              │
│Storage Heap - Total: 768 MB Used: 300 MB Available: 468 MB (60.9%)                                                              │
│                                                                                                                                 │
│NODE ID  ADDRESS     PORT   PROCESS  MEMBER     ROLE             STORAGE  MAX HEAP  USED HEAP  AVAIL HEAP                        │
│      1  /127.0.0.1  51436    25773  storage-1  CoherenceServer  true       256 MB      55 MB      201 MB                        │
│      2  /127.0.0.1  51438    25772  storage-0  CoherenceServer  true       256 MB     146 MB      110 MB                        │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
----

**Monitor the cluster and specify the `default-cache` layout and specify the cache `test1`**

[source,bash]
----
cohctl monitor cluster local -l default-cache -C test
----
Output:
[source,bash]
----
 Coherence CLI: 2024-05-06 11:13:59 - Monitoring cluster local (22.06.8) ESC to quit (press key in [] to toggle expand, ? = help).

┌─Caches [1]─────────────────────────────────────────────────────┐┌─Cache Indexes (PartitionedCache/test1) [2]────────────────────┐
│Total Caches: 3, Total primary storage: 0 MB                    ││Total Indexing Bytes:  0                                       │
│                                                                ││Total Indexing:        0 MB                                    │
│SERVICE           CACHE  COUNT  SIZE                            ││Total Indexing Millis: 0                                       │
│PartitionedCache  test1    100  0 MB                            │└───────────────────────────────────────────────────────────────┘
│PartitionedCache  test2    100  0 MB                            │
│PartitionedCache  test3    123  0 MB                            │
└────────────────────────────────────────────────────────────────┘
┌─Cache Access (PartitionedCache/test1) [3]───────────────────────────────────────────────────────────────────────────────────────┐
│NODE ID  TIER  COUNT  SIZE  PUTS  GETS  REMOVES  CLEARS  EVICTIONS                                                               │
│      1  back     34  0 MB    34   408        0       0          0                                                               │
│      2  back     34  0 MB    34   408        0       0          0                                                               │
│      3  back     32  0 MB    32   384        0       0          0                                                               │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
┌─Cache Storage (PartitionedCache/test1) [4]──────────────────────────────────────────────────────────────────────────────────────┐
│NODE ID  TIER  LOCKS GRANTED  LOCKS PENDING  KEY LISTENERS  FILTER LISTENERS  MAX QUERY MS  MAX QUERY DESC                       │
│      1  back              0              0              0                 0             0                                       │
│      2  back              0              0              0                 0             0                                       │
│      3  back              0              0              0                 0             0                                       │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
┌─Cache Partitions (PartitionedCache/test1) [5]─(trimmed)─────────────────────────────────────────────────────────────────────────┐
│Partitions:       82                                                                                                             │
│Total Count:      100                                                                                                            │
│Total Size:       0 MB                                                                                                           │
│Max Entry Size:   1,160 (bytes)                                                                                                  │
│Owning Partition: 0                                                                                                              │
│                                                                                                                                 │
│PARTITION  OWNING MEMBER  COUNT  SIZE  MAX ENTRY SIZE                                                                            │
│        0              2      1  0 MB           1,160                                                                            │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
----

NOTE: Any of the panels or layouts that specify `cache-*` or `service-*` must have the cache or service specified using
`-C` or `-S` respectively.


**Display all the available panels**

[source,bash]
----
cohctl monitor cluster --show-panels
----
Output:
[source,bash]
----
Valid panels

caches                : show caches
cache-access          : show cache access
cache-indexes         : show cache indexes
cache-storage         : show cache storage
cache-partitions      : show cache partitions
departedMembers       : show departed members
elastic-data          : show elastic data
executors             : show Executors
healthSummary         : show health summary
federation-all        : show all federation details
federation-dest       : show federation destinations
federation-origins    : show federation origins
http-servers          : show HTTP servers
http-sessions         : show HTTP sessions
machines              : show machines
membersSummary        : show members summary
members               : show members
membersShort          : show members (short)
network-stats         : show network stats
persistence           : show persistence
proxies               : show proxy servers
reporters             : show reporters
services              : show services
service-members       : show service members
service-distributions : show service distributions
service-storage       : show service storage
topics                : show topics
view-caches           : show view caches
----

=== See Also

* <<docs/reference/05_clusters.adoc,Clusters>>




